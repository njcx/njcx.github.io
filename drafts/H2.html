<!DOCTYPE html>
<html lang="zh">

<head>
  <!-- Required meta tags always come first -->
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="google-site-verification" content="GgupatpoZgdqsBlxEZoMqGAy3aXAFtXIrYged3SB6EA" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>lua快速入门 | nJcx's Blog
</title>
  <link rel="canonical" href="https://www.njcx.bid/drafts/H2.html">


  <link rel="apple-touch-icon" href="https://www.njcx.bid/apple-touch-icon.png" sizes="180x180">
  <link rel="icon" type="image/png" href="https://www.njcx.bid/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="https://www.njcx.bid/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="https://www.njcx.bid/manifest.json">
  <meta name="theme-color" content="#333333">

  <link rel="stylesheet" href="https://www.njcx.bid/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://www.njcx.bid/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://www.njcx.bid/theme/css/pygments/emacs.min.css">
  <link rel="stylesheet" href="https://www.njcx.bid/theme/css/style.css">


<meta name="description" content="lua学习后，转化成教程，方便大家阅读">
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?a34c7a96ae9745547c373575407c521f";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

</head>

<body>
  <header class="header">
    <div class="container">
      <div class="row">
        <div class="col-sm-4">
          <a href="https://www.njcx.bid">
            <img class="img-fluid" src=https://www.njcx.bid/images/profile.png width=200 height=200 alt="nJcx's Blog">
          </a>
        </div>
        <div class="col-sm-8">
          <h1 class="title">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<a href="https://www.njcx.bid">nJcx's Blog</a></h1>
          <p class="text-muted">十年生死两茫茫，写程序，到天亮。相顾无言，惟有泪千行</p>
          <ul class="list-inline">
                    <li class="list-inline-item">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<a href="https://www.zhihu.com/people/njcxs" target="_blank">知乎</a></li>
                <li class="list-inline-item"><a href="https://www.anquanke.com/member/154147" target="_blank">安全客</a></li>
                <li class="list-inline-item"><a href="https://www.freebuf.com/column/1481" target="_blank">Freebuf</a></li>
            <li class=" list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a class="fa fa-github" href="https://github.com/njcx" target="_blank"></a></li>
          </ul>
        </div>
      </div>
    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>lua快速入门
</h1>
      <hr>
<article class="article">
  <header>
    <ul class="list-inline">
      <li class="list-inline-item text-muted" title="2018-06-01T13:20:00+03:00">
        <i class="fa fa-clock-o"></i>
        五 01 六月 2018
      </li>
      <li class="list-inline-item">
        <i class="fa fa-folder-open-o"></i>
        <a href="https://www.njcx.bid/category/bian-cheng-yu-yan.html">编程语言</a>
      </li>
      <li class="list-inline-item">
        <i class="fa fa-user-o"></i>
        <a href="https://www.njcx.bid/author/njcx.html">nJcx</a>      </li>
      <li class="list-inline-item">
        <i class="fa fa-files-o"></i>
        <a href="https://www.njcx.bid/tag/lua.html">#lua</a>      </li>
    </ul>
  </header>
  <div class="content">
    <h5>介绍</h5>
<p>Lua 是一脚本语言，巴西人所开发。由标准C开发，方便嵌入应用程序中。几乎可以在所有操作系统和平台上都可以编译，运行。</p>
<h4>安装</h4>
<div class="highlight"><pre><span></span><code>$ brew install lua
<span class="c1"># yum install lua -y</span>
$ sudo apt-get -y install lua
</code></pre></div>
<p>包管理</p>
<div class="highlight"><pre><span></span><code>$ brew install luarocks
</code></pre></div>
<p>常用包</p>
<div class="highlight"><pre><span></span><code>luarocks install luasocket
luarocks install luasql-sqlite3
luarocks install lpeg
luarocks install lzlib
luarocks install luafilesystem
luarocks install luasec
luarocks install md5
luarocks install luacurl
luarocks install luasql-mysql 
luarocks install lua-cjson
</code></pre></div>
<h4>hello world</h4>
<p>老规矩</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/local/bin/lua</span>

print<span class="o">(</span><span class="s2">"Hello World！"</span><span class="o">)</span>
</code></pre></div>
<p>两个减号是单行注释:</p>
<p>-- 单行注释
--[ 单行注释 --]</p>
<p>--[[多行注释</p>
<p>多行注释--]]</p>
<h4>数据结构</h4>
<ul>
<li>nil  表示一个无效值， 在条件表达式中相当于false</li>
<li>boolean   包含两个值：false和true</li>
<li>number    表示双精度类型的实浮点数</li>
<li>string    字符串由一对双引号或单引号来表示 (通过'..'连接字符串，通过# 取得字符串长度)</li>
<li>table table是一个"关联数组"（associative arrays），数组的索引可以是数字或者是字符串。在 Lua 里，table构造表达式是{}，用来创建一个空表</li>
</ul>
<div class="highlight"><pre><span></span><code>&gt; print<span class="o">(</span><span class="c1">#"www.njcx.bid")</span>
<span class="m">12</span>
&gt; 
</code></pre></div>
<h4>运算符号</h4>
<div class="highlight"><pre><span></span><code>and
or  
not 
</code></pre></div>
<div class="highlight"><pre><span></span><code>+   加法  
-   减法  
*   乘法  
/   除法  
%   取余  
^   乘幂  
-   负号
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">==</span>  等于
~<span class="o">=</span>  不等于 //敲黑板
&gt;   大于
&lt;   小于 
&gt;<span class="o">=</span>  大于等于
&lt;<span class="o">=</span>  小于等于
</code></pre></div>
<h4>字符串</h4>
<div class="highlight"><pre><span></span><code>string.upper<span class="o">(</span>argument<span class="o">)</span>:
字符串全部转为大写字母。

string.lower<span class="o">(</span>argument<span class="o">)</span>:
字符串全部转为小写字母。

string.gsub<span class="o">(</span>mainString,findString,replaceString,num<span class="o">)</span>
在字符串中替换,mainString为要替换的字符串， findString 为被替换的字符，replaceString 要替换的字符，num 替换次数（可以忽略，则全部替换），如：
&gt; string.gsub<span class="o">(</span><span class="s2">"aaaa"</span>,<span class="s2">"a"</span>,<span class="s2">"z"</span>,3<span class="o">)</span><span class="p">;</span>
zzza    <span class="m">3</span>


string.find <span class="o">(</span>str, substr, <span class="o">[</span>init, <span class="o">[</span>end<span class="o">]])</span>
在一个指定的目标字符串中搜索指定的内容<span class="o">(</span>第三个参数为索引<span class="o">)</span>,返回其具体位置。不存在则返回 nil。
&gt; string.find<span class="o">(</span><span class="s2">"Hello Lua user"</span>, <span class="s2">"Lua"</span>, <span class="m">1</span><span class="o">)</span> 
<span class="m">7</span>    <span class="m">9</span>


string.reverse<span class="o">(</span>arg<span class="o">)</span>
字符串反转
&gt; string.reverse<span class="o">(</span><span class="s2">"Lua"</span><span class="o">)</span>
auL


string.format<span class="o">(</span>...<span class="o">)</span>
返回一个类似printf的格式化字符串
string.format<span class="o">(</span><span class="s2">"the value is:%d"</span>,4<span class="o">)</span>
the value is:4


string.char<span class="o">(</span>arg<span class="o">)</span> 和 string.byte<span class="o">(</span>arg<span class="o">[</span>,int<span class="o">])</span>
char 将整型数字转成字符并连接， byte 转换字符为整数值<span class="o">(</span>可以指定某个字符，默认第一个字符<span class="o">)</span>。
&gt; string.char<span class="o">(</span><span class="m">97</span>,98,99,100<span class="o">)</span>
abcd
&gt; string.byte<span class="o">(</span><span class="s2">"ABCD"</span>,4<span class="o">)</span>
<span class="m">68</span>
&gt; string.byte<span class="o">(</span><span class="s2">"ABCD"</span><span class="o">)</span>
<span class="m">65</span>


string.len<span class="o">(</span>arg<span class="o">)</span>
计算字符串长度。
string.len<span class="o">(</span><span class="s2">"abc"</span><span class="o">)</span>
<span class="m">3</span>

string.rep<span class="o">(</span>string, n<span class="o">)</span>
返回字符串string的n个拷贝
&gt; string.rep<span class="o">(</span><span class="s2">"abcd"</span>,2<span class="o">)</span>
abcdabcd

    ..
链接两个字符串
&gt; print<span class="o">(</span><span class="s2">"www.runoob"</span>..<span class="s2">"com"</span><span class="o">)</span>
www.runoobcom


string.gmatch<span class="o">(</span>str, pattern<span class="o">)</span>
回一个迭代器函数，每一次调用这个函数，返回一个在字符串 str 找到的下一个符合 pattern 描述的子串。如果参数 pattern 描述的字符串没有找到，迭代函数返回nil。
&gt; <span class="k">for</span> word <span class="k">in</span> string.gmatch<span class="o">(</span><span class="s2">"Hello Lua user"</span>, <span class="s2">"%a+"</span><span class="o">)</span> <span class="k">do</span> print<span class="o">(</span>word<span class="o">)</span> end
Hello
Lua
user

string.match<span class="o">(</span>str, pattern, init<span class="o">)</span>
string.match<span class="o">()</span>只寻找源字串str中的第一个配对. 参数init可选, 指定搜寻过程的起点, 默认为1。 
在成功配对时, 函数将返回配对表达式中的所有捕获结果<span class="p">;</span> 如果没有设置捕获标记, 则返回整个配对字符串. 当没有成功的配对时, 返回nil。
&gt; <span class="o">=</span> string.match<span class="o">(</span><span class="s2">"I have 2 questions for you."</span>, <span class="s2">"%d+ %a+"</span><span class="o">)</span>
<span class="m">2</span> questions

&gt; <span class="o">=</span> string.format<span class="o">(</span><span class="s2">"%d, %q"</span>, string.match<span class="o">(</span><span class="s2">"I have 2 questions for you."</span>, <span class="s2">"(%d+) (%a+)"</span><span class="o">))</span>
<span class="m">2</span>, <span class="s2">"questions"</span>
</code></pre></div>
<h4>数组</h4>
<div class="highlight"><pre><span></span><code><span class="nv">array</span> <span class="o">=</span> <span class="o">{}</span>
<span class="nv">array</span> <span class="o">=</span> <span class="o">{</span>‘njcx’，‘demo’<span class="o">}</span>
<span class="nv">Table</span> <span class="o">=</span> <span class="o">{</span><span class="nv">name</span><span class="o">=</span><span class="s2">"盘子脸"</span>,age<span class="o">=</span><span class="m">18</span>,isMan<span class="o">=</span>true<span class="o">}</span> 
</code></pre></div>
<p>在Lua索引值是以 默认1为起始，</p>
<div class="highlight"><pre><span></span><code>table.concat <span class="o">(</span>table <span class="o">[</span>, sep <span class="o">[</span>, start <span class="o">[</span>, end<span class="o">]]])</span>:
concat是concatenate<span class="o">(</span>连锁, 连接<span class="o">)</span>的缩写. table.concat<span class="o">()</span>函数列出参数中指定table的数组部分从start位置到end位置的所有元素, 元素间以指定的分隔符<span class="o">(</span>sep<span class="o">)</span>隔开。

table.insert <span class="o">(</span>table, <span class="o">[</span>pos,<span class="o">]</span> value<span class="o">)</span>:
在table的数组部分指定位置<span class="o">(</span>pos<span class="o">)</span>插入值为value的一个元素. pos参数可选, 默认为数组部分末尾.

table.maxn <span class="o">(</span>table<span class="o">)</span>
指定table中所有正数key值中最大的key值. 如果不存在key值为正数的元素, 则返回0。<span class="o">(</span>Lua5.2之后该方法已经不存在了,本文使用了自定义函数实现<span class="o">)</span>

table.remove <span class="o">(</span>table <span class="o">[</span>, pos<span class="o">])</span>
返回table数组部分位于pos位置的元素. 其后的元素会被前移. pos参数可选, 默认为table长度, 即从最后一个元素删起。

table.sort <span class="o">(</span>table <span class="o">[</span>, comp<span class="o">])</span>
对给定的table进行升序排序。
</code></pre></div>
<h4>变量,循环,流程控制</h4>
<ul>
<li>变量</li>
</ul>
<p>Lua 变量有三种类型：全局变量、局部变量、表中的域。
Lua 中的变量全是全局变量，那怕是语句块或是函数里，除非用 local 显式声明为局部变量。局部变量的作用域为从声明位置开始到所在语句块结束。变量的默认值均为 nil。</p>
<div class="highlight"><pre><span></span><code><span class="nv">a</span> <span class="o">=</span> <span class="m">5</span>               -- 全局变量
<span class="nb">local</span> <span class="nv">b</span> <span class="o">=</span> <span class="m">5</span>         -- 局部变量

<span class="k">function</span> joke<span class="o">()</span>
    <span class="nv">c</span> <span class="o">=</span> <span class="m">5</span>           -- 全局变量
    <span class="nb">local</span> <span class="nv">d</span> <span class="o">=</span> <span class="m">6</span>     -- 局部变量
end
joke<span class="o">()</span>
print<span class="o">(</span>c,d<span class="o">)</span>          --&gt; <span class="m">5</span> nil
</code></pre></div>
<ul>
<li>循环</li>
</ul>
<p>while</p>
<div class="highlight"><pre><span></span><code><span class="nv">a</span><span class="o">=</span><span class="m">10</span>
<span class="k">while</span><span class="o">(</span> a &lt; <span class="m">20</span> <span class="o">)</span>
<span class="k">do</span>
   print<span class="o">(</span><span class="s2">"a 的值为:"</span>, a<span class="o">)</span>
   <span class="nv">a</span> <span class="o">=</span> a+1
end

<span class="k">while</span><span class="o">(</span> <span class="nb">true</span> <span class="o">)</span>
<span class="k">do</span>
   print<span class="o">(</span><span class="s2">"循环将永远执行下去"</span><span class="o">)</span>
end
</code></pre></div>
<p>for  </p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="nv">var</span><span class="o">=</span>exp1,exp2,exp3 <span class="k">do</span>  
    &lt;执行体&gt;  
end  
var 从 exp1 变化到 exp2，每次变化以 exp3 为步长递增 var，并执行一次 <span class="s2">"执行体"</span>。exp3 是可选的，如果不指定，默认为1。

<span class="k">for</span> <span class="nv">i</span><span class="o">=</span><span class="m">1</span>,f<span class="o">(</span>x<span class="o">)</span> <span class="k">do</span>
    print<span class="o">(</span>i<span class="o">)</span>
end

<span class="k">for</span> <span class="nv">i</span><span class="o">=</span><span class="m">10</span>,1,-1 <span class="k">do</span>
    print<span class="o">(</span>i<span class="o">)</span>
end
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nv">days</span><span class="o">={</span><span class="s2">"Sunday"</span>,<span class="s2">"Monday"</span>,<span class="s2">"Tuesday"</span>,<span class="s2">"Wednesday"</span>,<span class="s2">"Thursday"</span>,<span class="s2">"Friday"</span>,<span class="s2">"Saturday"</span><span class="o">}</span>  
<span class="k">for</span> i,v <span class="k">in</span> ipairs<span class="o">(</span>days<span class="o">)</span> <span class="k">do</span> 
    print<span class="o">(</span>v<span class="o">)</span> 
end  
</code></pre></div>
<p>这里提一下pairs能够遍历表中全部的key，而ipairs则不能返回nil,遇到nil则退出。</p>
<p>repeat</p>
<div class="highlight"><pre><span></span><code>--<span class="o">[</span> 变量定义 --<span class="o">]</span>
<span class="nv">a</span> <span class="o">=</span> <span class="m">10</span>
--<span class="o">[</span> 执行循环 --<span class="o">]</span>
repeat
   print<span class="o">(</span><span class="s2">"a的值为:"</span>, a<span class="o">)</span>
   <span class="nv">a</span> <span class="o">=</span> a + <span class="m">1</span>
<span class="k">until</span><span class="o">(</span> a &gt; <span class="m">15</span> <span class="o">)</span>
</code></pre></div>
<p>repeat 没有do end</p>
<ul>
<li>流程控制</li>
</ul>
<p>if  （then  do）</p>
<div class="highlight"><pre><span></span><code>--<span class="o">[</span> 定义变量 --<span class="o">]</span>
<span class="nv">a</span> <span class="o">=</span> <span class="m">10</span><span class="p">;</span>

--<span class="o">[</span> 使用 <span class="k">if</span> 语句 --<span class="o">]</span>
<span class="k">if</span><span class="o">(</span> a &lt; <span class="m">20</span> <span class="o">)</span>
<span class="k">then</span>
   --<span class="o">[</span> <span class="k">if</span> 条件为 <span class="nb">true</span> 时打印以下信息 --<span class="o">]</span>
   print<span class="o">(</span><span class="s2">"a 小于 20"</span> <span class="o">)</span><span class="p">;</span>
end
print<span class="o">(</span><span class="s2">"a 的值为:"</span>, a<span class="o">)</span><span class="p">;</span>
</code></pre></div>
<p>if else</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="o">(</span>布尔表达式<span class="o">)</span>
<span class="k">then</span>
   --<span class="o">[</span> 布尔表达式为 <span class="nb">true</span> 时执行该语句块 --<span class="o">]</span>
<span class="k">else</span>
   --<span class="o">[</span> 布尔表达式为 <span class="nb">false</span> 时执行该语句块 --<span class="o">]</span>
end
</code></pre></div>
<p>if...elseif...else </p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="o">(</span> 布尔表达式 <span class="m">1</span><span class="o">)</span>
<span class="k">then</span>
   --<span class="o">[</span> 在布尔表达式 <span class="m">1</span> 为 <span class="nb">true</span> 时执行该语句块 --<span class="o">]</span>

elseif<span class="o">(</span> 布尔表达式 <span class="m">2</span><span class="o">)</span>
<span class="k">then</span>
   --<span class="o">[</span> 在布尔表达式 <span class="m">2</span> 为 <span class="nb">true</span> 时执行该语句块 --<span class="o">]</span>

elseif<span class="o">(</span> 布尔表达式 <span class="m">3</span><span class="o">)</span>
<span class="k">then</span>
   --<span class="o">[</span> 在布尔表达式 <span class="m">3</span> 为 <span class="nb">true</span> 时执行该语句块 --<span class="o">]</span>
<span class="k">else</span> 
   --<span class="o">[</span> 如果以上布尔表达式都不为 <span class="nb">true</span> 则执行该语句块 --<span class="o">]</span>
end
</code></pre></div>
<h4>函数</h4>
<p>函数名前面加 local代表局部函数，不然，就代表全局函数，lua的函数支持多返回值</p>
<div class="highlight"><pre><span></span><code>--<span class="o">[[</span> 函数返回两个值的最大值 --<span class="o">]]</span>
<span class="k">function</span> max<span class="o">(</span>num1, num2<span class="o">)</span>

   <span class="k">if</span> <span class="o">(</span>num1 &gt; num2<span class="o">)</span> <span class="k">then</span>
      <span class="nv">result</span> <span class="o">=</span> num1<span class="p">;</span>
   <span class="k">else</span>
      <span class="nv">result</span> <span class="o">=</span> num2<span class="p">;</span>
   end

   <span class="k">return</span> result<span class="p">;</span> 
end
-- 调用函数
print<span class="o">(</span><span class="s2">"两值比较最大值为 "</span>,max<span class="o">(</span><span class="m">10</span>,4<span class="o">))</span>
</code></pre></div>
<p>可变参数</p>
<p>Lua 函数可以接受可变数目的参数，在函数参数列表中使用三点 ... 表示函数有可变的参数。</p>
<div class="highlight"><pre><span></span><code><span class="k">function</span> add<span class="o">(</span>...<span class="o">)</span>  
<span class="nb">local</span> <span class="nv">s</span> <span class="o">=</span> <span class="m">0</span>  
  <span class="k">for</span> i, v <span class="k">in</span> ipairs<span class="o">{</span>...<span class="o">}</span> <span class="k">do</span>   --&gt; <span class="o">{</span>...<span class="o">}</span> 表示一个由所有变长参数构成的数组  
    <span class="nv">s</span> <span class="o">=</span> s + v  
  end  
  <span class="k">return</span> s  
end  
print<span class="o">(</span>add<span class="o">(</span><span class="m">3</span>,4,5,6,7<span class="o">))</span>  ---&gt;25
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">function</span> average<span class="o">(</span>...<span class="o">)</span>
   <span class="nv">result</span> <span class="o">=</span> <span class="m">0</span>
   <span class="nb">local</span> <span class="nv">arg</span><span class="o">={</span>...<span class="o">}</span>    --&gt; arg 为一个表，局部变量
   <span class="k">for</span> i,v <span class="k">in</span> ipairs<span class="o">(</span>arg<span class="o">)</span> <span class="k">do</span>
      <span class="nv">result</span> <span class="o">=</span> result + v
   end
   print<span class="o">(</span><span class="s2">"总共传入 "</span> .. <span class="c1">#arg .. " 个数")</span>
   <span class="k">return</span> result/#arg
end

print<span class="o">(</span><span class="s2">"平均值为"</span>,average<span class="o">(</span><span class="m">10</span>,5,3,4,5,6<span class="o">))</span>
</code></pre></div>
<p>也可以用 select("#",...)  获取长度，
select('#', …) 返回可变参数的长度,
select(n, …) 用于访问 n 到 select('#',…) 的参数</p>
<div class="highlight"><pre><span></span><code><span class="k">function</span> foo<span class="o">(</span>...<span class="o">)</span>  
    <span class="k">for</span> <span class="nv">i</span> <span class="o">=</span> <span class="m">1</span>, <span class="k">select</span><span class="o">(</span><span class="s1">'#'</span>, ...<span class="o">)</span> <span class="k">do</span>  --&gt;获取参数总数
        <span class="nb">local</span> <span class="nv">arg</span> <span class="o">=</span> <span class="k">select</span><span class="o">(</span>i, ...<span class="o">)</span><span class="p">;</span> --&gt;读取参数
        print<span class="o">(</span><span class="s2">"arg"</span>, arg<span class="o">)</span><span class="p">;</span>  
    end  
end 
</code></pre></div>
<p>lua 也可以固定函数参数</p>
<div class="highlight"><pre><span></span><code><span class="k">function</span> fwrite<span class="o">(</span>fmt, ...<span class="o">)</span>  ---&gt; 固定的参数fmt
    <span class="k">return</span> io.write<span class="o">(</span>string.format<span class="o">(</span>fmt, ...<span class="o">))</span>     
end

fwrite<span class="o">(</span><span class="s2">"tudou\n"</span><span class="o">)</span>       ---&gt;fmt <span class="o">=</span> <span class="s2">"tudou"</span>, 没有变长参数。 
</code></pre></div>
<h4>Lua 模块与包</h4>
<p>Lua 的模块是由变量、函数等已知元素组成的 table，因此创建一个模块很简单，就是创建一个 table，然后把需要导出的常量、函数放入其中，最后返回这个 table 就行。以下为创建自定义模块 module.lua，文件代码格式如下：</p>
<div class="highlight"><pre><span></span><code>-- 文件名为 module.lua
-- 定义一个名为 module 的模块
<span class="nv">module</span> <span class="o">=</span> <span class="o">{}</span>

-- 定义一个常量
module.constant <span class="o">=</span> <span class="s2">"这是一个常量"</span>

-- 定义一个函数
<span class="k">function</span> module.func1<span class="o">()</span>
    io.write<span class="o">(</span><span class="s2">"这是一个公有函数！\n"</span><span class="o">)</span>
end

<span class="nb">local</span> <span class="k">function</span> func2<span class="o">()</span>
    print<span class="o">(</span><span class="s2">"这是一个私有函数！"</span><span class="o">)</span>
end

<span class="k">function</span> module.func3<span class="o">()</span>
    func2<span class="o">()</span>
end

<span class="k">return</span> module
</code></pre></div>
<h4>元表</h4>
<p>待补充</p>
<h4>lua协程(coroutine)</h4>
<p>待补充</p>
<h4>lua 面向对象</h4>
<p>待补充</p>
<h4>lua 的异常处理</h4>
<p>Lua中处理错误，可以使用函数pcall（protected call）来包装需要执行的代码。</p>
<p>pcall接收一个函数和要传递给后者的参数，并执行，执行结果：有错误、无错误；返回值true或者或false, errorinfo。</p>
<p>语法格式如下</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> pcall<span class="o">(</span>function_name, ….<span class="o">)</span> <span class="k">then</span>
-- 没有错误
<span class="k">else</span>
-- 一些错误
end


pcall<span class="o">(</span><span class="k">function</span><span class="o">(</span>i<span class="o">)</span> print<span class="o">(</span>i<span class="o">)</span> end, <span class="m">33</span><span class="o">)</span>
<span class="m">33</span>
<span class="nb">true</span>

pcall<span class="o">(</span><span class="k">function</span><span class="o">(</span>i<span class="o">)</span> print<span class="o">(</span>i<span class="o">)</span> error<span class="o">(</span><span class="s1">'error..'</span><span class="o">)</span> end, <span class="m">33</span><span class="o">)</span>
<span class="m">33</span>
<span class="nb">false</span>        stdin:1: error..


<span class="k">function</span> f<span class="o">()</span> <span class="k">return</span> false,2 end
<span class="k">if</span> f<span class="o">()</span> <span class="k">then</span> print <span class="s1">'1'</span> <span class="k">else</span> print <span class="s1">'0'</span> end

<span class="m">0</span>
</code></pre></div>
<p>pcall以一种"保护模式"来调用第一个参数，因此pcall可以捕获函数执行中的任何错误。</p>
<p>通常在错误发生时，希望落得更多的调试信息，而不只是发生错误的位置。但pcall返回时，它已经销毁了调用桟的部分内容。</p>
<p>Lua提供了xpcall函数，xpcall接收第二个参数——一个错误处理函数，当错误发生时，Lua会在调用桟展开（unwind）前调用错误处理函数，于是就可以在这个函数中使用debug库来获取关于错误的额外信息了。</p>
<p>debug库提供了两个通用的错误处理函数:
debug.debug：提供一个Lua提示符，让用户来检查错误的原因
debug.traceback：根据调用桟来构建一个扩展的错误消息</p>
<div class="highlight"><pre><span></span><code>xpcall<span class="o">(</span><span class="k">function</span><span class="o">(</span>i<span class="o">)</span> print<span class="o">(</span>i<span class="o">)</span> error<span class="o">(</span><span class="s1">'error..'</span><span class="o">)</span> end, <span class="k">function</span><span class="o">()</span> print<span class="o">(</span>debug.traceback<span class="o">())</span> end, <span class="m">33</span><span class="o">)</span>
<span class="m">33</span>

stack traceback:
stdin:1: <span class="k">in</span> <span class="k">function</span> &lt;stdin:1&gt;
<span class="o">[</span>C<span class="o">]</span>: <span class="k">in</span> <span class="k">function</span> <span class="s1">'error'</span>
stdin:1: <span class="k">in</span> <span class="k">function</span> &lt;stdin:1&gt;
<span class="o">[</span>C<span class="o">]</span>: <span class="k">in</span> <span class="k">function</span> <span class="s1">'xpcall'</span>
stdin:1: <span class="k">in</span> main chunk
<span class="o">[</span>C<span class="o">]</span>: <span class="k">in</span> ?
<span class="nb">false</span>        nil
</code></pre></div>
<p>xpcall 使用实例 2:</p>
<div class="highlight"><pre><span></span><code><span class="k">function</span> myfunction <span class="o">()</span>
   <span class="nv">n</span> <span class="o">=</span> n/nil
end

<span class="k">function</span> myerrorhandler<span class="o">(</span> err <span class="o">)</span>
   print<span class="o">(</span> <span class="s2">"ERROR:"</span>, err <span class="o">)</span>
end

<span class="nv">status</span> <span class="o">=</span> xpcall<span class="o">(</span> myfunction, myerrorhandler <span class="o">)</span>
print<span class="o">(</span> status<span class="o">)</span>
</code></pre></div>
<p>执行以上程序会出现如下错误：</p>
<div class="highlight"><pre><span></span><code>ERROR:    test2.lua:2: attempt to perform arithmetic on global <span class="s1">'n'</span> <span class="o">(</span>a nil value<span class="o">)</span>
<span class="nb">false</span>
</code></pre></div>
  </div>
</article>
<div id="cyReward" role="cylabs" data-use="reward" style="text-align:center;"></div>
<!--PC和WAP自适应版-->
<div id="SOHUCS" ></div> 
<script type="text/javascript"> 
(function(){ 
var appid = 'cysYUIjwy'; 
var conf = 'prod_71b5e53cad0d27b5ed44fa5219b069b5'; 
var width = window.innerWidth || document.documentElement.clientWidth; 
if (width < 960) { 
window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>

<script type="text/javascript" charset="utf-8" src="https://changyan.itc.cn/js/lib/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="https://changyan.sohu.com/js/changyan.labs.https.js?appid=cysYUIjwy"></script>    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="row">
       <ul class="col-sm-6 list-inline">
          <li class="list-inline-item"><a href="https://www.njcx.bid/authors.html">Authors</a></li>
          <li class="list-inline-item"><a href="https://www.njcx.bid/archives.html">Archives</a></li>
          <li class="list-inline-item"><a href="https://www.njcx.bid/categories.html">Categories</a></li>
          <li class="list-inline-item"><a href="https://www.njcx.bid/tags.html">Tags</a></li>
        </ul>
        <p class="col-sm-6 text-sm-right text-muted">
          本站由 <a href="https://github.com/getpelican/pelican" target="_blank">Pelican 生成</a> 后续 by <a href="https://github.com/njcx" target="_blank">nJcx</a>
        </p>
      </div>
    </div>
  </footer>
</body>

</html>